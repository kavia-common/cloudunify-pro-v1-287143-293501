{"is_source_file": true, "format": "Python", "description": "This file contains comprehensive unit tests for a FastAPI-based backend API. It tests user authentication, resource management, cost summaries, recommendations, and automation rules through API endpoints, including authorization and filtering features.", "external_files": ["src.api.main", "src.api.models", "src.api.security"], "external_methods": ["get_password_hash", "select", "create_async_engine", "async_sessionmaker", "AsyncSession"], "published": ["TEST_USER_EMAIL", "TEST_USER_PASS", "TEST_ADMIN_EMAIL", "TEST_ADMIN_PASS"], "classes": [], "methods": [{"name": "_ensure_user(email: str, password: str, role: str = \"user\", is_active: bool = True)", "description": "Asynchronously creates or updates a user in the database with specified email, password, role, and active status.", "scope": "", "scopeKind": ""}, {"name": "str _login(email: str, password: str)", "description": "Logs in a user by sending credentials to the /auth/login endpoint and returns the access token.", "scope": "", "scopeKind": ""}, {"name": "dict _auth_header(token: str)", "description": "Constructs authorization headers with a Bearer token.", "scope": "", "scopeKind": ""}, {"name": "test_resources_list_and_authz()", "description": "Tests resource listing, filtering, and authorization handling.", "scope": "", "scopeKind": ""}, {"name": "test_costs_summary_and_authz()", "description": "Tests cost summaries, including ingestion and filtering, with authorization checks.", "scope": "", "scopeKind": ""}, {"name": "test_recommendations_list_filters_and_authz()", "description": "Tests recommendations listing, insertion, filtering, and authorization.", "scope": "", "scopeKind": ""}, {"name": "test_automation_rules_get_post_rbac()", "description": "Tests RBAC permissions for automation rules endpoints, including listing, creating, and role-based access control.", "scope": "", "scopeKind": ""}, {"name": "_insert_rec()", "scope": "test_recommendations_list_filters_and_authz", "scopeKind": "function", "description": "unavailable"}], "calls": ["client.post", "client.get", "asyncio.get_event_loop().run_until_complete", "session.execute", "session.commit", "session.add"], "search-terms": ["test_feature_endpoints", "authorization tests", "resource tests", "recommendations tests", "automation rules tests", "async user setup", "FastAPI test client"], "state": 2, "file_id": 29, "knowledge_revision": 72, "git_revision": "5740c92ab23881bce3da3d9b07dc83e055289f49", "ctags": [{"_type": "tag", "name": "TEST_ADMIN_EMAIL", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^TEST_ADMIN_EMAIL = \"features-admin@example.com\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TEST_ADMIN_PASS", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^TEST_ADMIN_PASS = \"AdminPa55!\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TEST_USER_EMAIL", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^TEST_USER_EMAIL = \"features-user@example.com\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TEST_USER_PASS", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^TEST_USER_PASS = \"UserPa55!\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_auth_header", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^def _auth_header(token: str) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(token: str)"}, {"_type": "tag", "name": "_ensure_user", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^async def _ensure_user(email: str, password: str, role: str = \"user\", is_active: bool = True):$/", "language": "Python", "kind": "function", "signature": "(email: str, password: str, role: str = \"user\", is_active: bool = True)"}, {"_type": "tag", "name": "_insert_rec", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^    async def _insert_rec():$/", "file": true, "language": "Python", "kind": "function", "signature": "()", "scope": "test_recommendations_list_filters_and_authz", "scopeKind": "function"}, {"_type": "tag", "name": "_login", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^def _login(email: str, password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(email: str, password: str)"}, {"_type": "tag", "name": "client", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^client = TestClient(app)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "test_automation_rules_get_post_rbac", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^def test_automation_rules_get_post_rbac():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "test_costs_summary_and_authz", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^def test_costs_summary_and_authz():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "test_recommendations_list_filters_and_authz", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^def test_recommendations_list_filters_and_authz():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "test_resources_list_and_authz", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_feature_endpoints.py", "pattern": "/^def test_resources_list_and_authz():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "56ad36f4351736906b8359123330e6c3", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/tests/test_feature_endpoints.py", "fields": [{"name": "TEST_ADMIN_EMAIL = \"features-admin@example.com\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TEST_ADMIN_PASS = \"AdminPa55!\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TEST_USER_EMAIL = \"features-user@example.com\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TEST_USER_PASS = \"UserPa55!\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "client = TestClient(app)", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"72": "5740c92ab23881bce3da3d9b07dc83e055289f49"}]}