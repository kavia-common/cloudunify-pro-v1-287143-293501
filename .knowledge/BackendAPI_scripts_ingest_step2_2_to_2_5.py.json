{"is_source_file": true, "format": "Python", "description": "This script performs ingestion of resource and recommendation data from XLSX files into a PostgreSQL database for the CloudUnify Pro project. It handles parsing Excel files, upserting organizations, cloud accounts, resources, costs, and recommendations, and generating an import report.", "external_files": ["dotenv", "openpyxl", "psycopg", "psycopg.types.json"], "external_methods": ["load_dotenv", "load_workbook", "psycopg.connect", "urlparse", "parse_qsl", "urlencode", "_read_xlsx_rows", "_is_missing", "_normalize_provider", "_normalize_priority", "_parse_datetime", "_to_decimal_or_none", "_parse_tags"], "published": ["run"], "classes": [{"name": "TableCounts", "description": "Tracks insertion, update, and skipped counts for a specific database table."}, {"name": "FileReport", "description": "Represents the outcome of processing a specific input file, including counts per relevant tables."}], "methods": [{"name": "str _ensure_ssl_and_channel_binding(dsn: str)", "description": "Ensures that the given DSN includes sslmode=require and channel_binding=require parameters, and normalizes URLs.", "scope": "", "scopeKind": ""}, {"name": "datetime _now_utc()", "description": "Returns the current UTC datetime.", "scope": "", "scopeKind": ""}, {"name": "bool _is_missing(v: Any)", "description": "Checks if a value is None, empty string, or NaN, indicating missing data.", "scope": "", "scopeKind": ""}, {"name": "str _snake(s: str)", "description": "Converts a string into snake_case.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _provider_from_filename(name: str)", "description": "Detects the provider type from a filename based on contained substrings.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _normalize_provider(v: Any)", "description": "Normalizes various representations of provider names to standard lowercase identifiers.", "scope": "", "scopeKind": ""}, {"name": "str _normalize_priority(v: Any)", "description": "Normalizes priority values into standard categories with default 'medium'.", "scope": "", "scopeKind": ""}, {"name": "Optional[datetime] _parse_datetime(v: Any)", "description": "Parses a datetime value from Excel cell or ISO string.", "scope": "", "scopeKind": ""}, {"name": "Optional[Decimal] _to_decimal_or_none(v: Any)", "description": "Attempts to convert a value to Decimal; returns None if invalid.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,str] _parse_tags(v: Any)", "description": "Parses tags from dict or comma-separated string into a dictionary.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] _read_xlsx_rows(path: Path)", "description": "Reads rows from an XLSX file, returning list of dicts with snake_case headers.", "scope": "", "scopeKind": ""}, {"name": "bool _table_exists(conn: psycopg.Connection, table: str)", "description": "Checks if a specific table exists in the PostgreSQL database.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,bool] _upsert_org(conn: psycopg.Connection, name: str, slug: str)", "description": "Inserts or updates an organization record based on slug, returning its ID and whether it was inserted.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,bool] _upsert_cloud_account( conn: psycopg.Connection, *, organization_id: str, provider: str, account_external_id: str, account_name: str, )", "description": "Inserts or updates a cloud account linked to an organization, returning its ID and insertion status.", "scope": "", "scopeKind": ""}, {"name": "str _stable_recommendation_uuid( organization_id: str, provider: str, recommendation_id: Any, row: Dict[str, Any] )", "description": "Generates a stable UUID for recommendations based on key fields to ensure idempotency.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _find_resource_internal_id( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, external_resource_id: str, )", "description": "Resolves a resource's internal UUID in the database based on stable keys.", "scope": "", "scopeKind": ""}, {"name": "FileReport _ingest_resources_xlsx( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, path: Path, has_resource_costs_daily: bool, )", "description": "Processes an XLSX file containing resource data, inserting/updating resources and costs.", "scope": "", "scopeKind": ""}, {"name": "FileReport _ingest_recommendations_xlsx( conn: psycopg.Connection, *, organization_id: str, cloud_account_ids: Dict[str, str], path: Path, )", "description": "Processes an XLSX file containing recommendations, linking to resources and inserting recommendations.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,TableCounts] _sum_table_counts(reports: Iterable[FileReport])", "description": "Aggregates counts from multiple FileReports into totals.", "scope": "", "scopeKind": ""}, {"name": "str _render_markdown_report( *, started_at: datetime, finished_at: datetime, database_url: str, org: Dict[str, Any], lookups: Dict[str, TableCounts], file_reports: List[FileReport], totals: Dict[str, TableCounts], )", "description": "Generates a markdown-formatted report summarizing the import process and statistics.", "scope": "", "scopeKind": ""}, {"name": "int run()", "description": "Main CLI entry point that orchestrates the data ingestion from files, database interactions, and report generation.", "scope": "", "scopeKind": ""}, {"name": "str _row(table: str, c: TableCounts)", "scope": "_render_markdown_report", "scopeKind": "function", "description": "unavailable"}, {"name": "None load_dotenv(*args: Any, **kwargs: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["load_dotenv", "load_workbook", "psycopg.connect", "urlparse", "parse_qsl", "urlencode", "_read_xlsx_rows", "_is_missing", "_normalize_provider", "_normalize_priority", "_parse_datetime", "_to_decimal_or_none", "_parse_tags", "_table_exists", "_upsert_org", "_upsert_cloud_account", "_stable_recommendation_uuid", "_find_resource_internal_id", "_ingest_resources_xlsx", "_ingest_recommendations_xlsx", "_sum_table_counts", "_render_markdown_report", "json.dumps", "Path.write_text"], "search-terms": ["ingest_step2_2_to_2_5", "XLSX resources ingestion", "recommendations ingestion", "Neon schema", "CloudUnify Pro", "resource_costs_daily", "recommendation_id", "resource_id", "resource_type", "recommendation_type", "potential_savings_monthly", "cloud_provider", "organization_id", "uuid", "recommendations", "resources", "cost_daily"], "state": 2, "file_id": 44, "knowledge_revision": 130, "git_revision": "89f40ff48ae524bd64073d16537712d5bcb17dba", "revision_history": [{"129": "3f065c9d5471e043ec358da4fd501f435cc3cd8c"}, {"130": "89f40ff48ae524bd64073d16537712d5bcb17dba"}], "ctags": [{"_type": "tag", "name": "FileReport", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^class FileReport:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "NAMESPACE_RECOMMENDATION", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^NAMESPACE_RECOMMENDATION = uuid.UUID(\"1d4ab8e8-0d5e-4c1a-9a41-2a30f1a34a2c\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PRIORITIES", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^PRIORITIES = {\"low\", \"medium\", \"high\", \"critical\"}$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PROVIDERS", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^PROVIDERS = (\"aws\", \"azure\", \"gcp\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TableCounts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^class TableCounts:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ensure_ssl_and_channel_binding", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _ensure_ssl_and_channel_binding(dsn: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(dsn: str)"}, {"_type": "tag", "name": "_find_resource_internal_id", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _find_resource_internal_id($/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, external_resource_id: str, )"}, {"_type": "tag", "name": "_ingest_recommendations_xlsx", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _ingest_recommendations_xlsx($/", "language": "Python", "typeref": "typename:FileReport", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, cloud_account_ids: Dict[str, str], path: Path, )"}, {"_type": "tag", "name": "_ingest_resources_xlsx", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _ingest_resources_xlsx($/", "language": "Python", "typeref": "typename:FileReport", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, path: Path, has_resource_costs_daily: bool, )"}, {"_type": "tag", "name": "_is_missing", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _is_missing(v: Any) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_normalize_priority", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _normalize_priority(v: Any) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_normalize_provider", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _normalize_provider(v: Any) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_now_utc", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _now_utc() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_parse_datetime", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _parse_datetime(v: Any) -> Optional[datetime]:$/", "language": "Python", "typeref": "typename:Optional[datetime]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_parse_tags", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _parse_tags(v: Any) -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_provider_from_filename", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _provider_from_filename(name: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_read_xlsx_rows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _read_xlsx_rows(path: Path) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(path: Path)"}, {"_type": "tag", "name": "_render_markdown_report", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _render_markdown_report($/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "( *, started_at: datetime, finished_at: datetime, database_url: str, org: Dict[str, Any], lookups: Dict[str, TableCounts], file_reports: List[FileReport], totals: Dict[str, TableCounts], )"}, {"_type": "tag", "name": "_row", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    def _row(table: str, c: TableCounts) -> str:$/", "file": true, "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(table: str, c: TableCounts)", "scope": "_render_markdown_report", "scopeKind": "function"}, {"_type": "tag", "name": "_snake", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _snake(s: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(s: str)"}, {"_type": "tag", "name": "_stable_recommendation_uuid", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _stable_recommendation_uuid($/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "( organization_id: str, provider: str, recommendation_id: Any, row: Dict[str, Any] )"}, {"_type": "tag", "name": "_sum_table_counts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _sum_table_counts(reports: Iterable[FileReport]) -> Dict[str, TableCounts]:$/", "language": "Python", "typeref": "typename:Dict[str,TableCounts]", "kind": "function", "signature": "(reports: Iterable[FileReport])"}, {"_type": "tag", "name": "_table_exists", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _table_exists(conn: psycopg.Connection, table: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: psycopg.Connection, table: str)"}, {"_type": "tag", "name": "_to_decimal_or_none", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _to_decimal_or_none(v: Any) -> Optional[Decimal]:$/", "language": "Python", "typeref": "typename:Optional[Decimal]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_upsert_cloud_account", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _upsert_cloud_account($/", "language": "Python", "typeref": "typename:Tuple[str,bool]", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, provider: str, account_external_id: str, account_name: str, )"}, {"_type": "tag", "name": "_upsert_org", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _upsert_org(conn: psycopg.Connection, name: str, slug: str) -> Tuple[str, bool]:$/", "language": "Python", "typeref": "typename:Tuple[str,bool]", "kind": "function", "signature": "(conn: psycopg.Connection, name: str, slug: str)"}, {"_type": "tag", "name": "inserted", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    inserted: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TableCounts", "scopeKind": "class"}, {"_type": "tag", "name": "load_dotenv", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    def load_dotenv(*args: Any, **kwargs: Any) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(*args: Any, **kwargs: Any)"}, {"_type": "tag", "name": "run", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def run() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "skipped", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    skipped: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TableCounts", "scopeKind": "class"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    updated: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TableCounts", "scopeKind": "class"}], "hash": "2b7c44e390a1958f92fe332e50a95ec6", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/scripts/ingest_step2_2_to_2_5.py", "fields": [{"name": "NAMESPACE_RECOMMENDATION = uuid.UUID(\"1d4ab8e8-0d5e-4c1a-9a41-2a30f1a34a2c\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PRIORITIES = {\"low\", \"medium\", \"high\", \"critical\"}", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PROVIDERS = (\"aws\", \"azure\", \"gcp\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int inserted", "scope": "TableCounts", "scopeKind": "class", "description": "unavailable"}, {"name": "int skipped", "scope": "TableCounts", "scopeKind": "class", "description": "unavailable"}, {"name": "int updated", "scope": "TableCounts", "scopeKind": "class", "description": "unavailable"}]}