{"is_source_file": true, "format": "python", "description": "This script automates ingestion of XLSX files containing cloud resource data and recommendations into a PostgreSQL database for the CloudUnify Pro project. It processes resource and cost data for AWS, Azure, GCP, as well as recommendations, performing inserts and updates while generating reports.", "external_files": ["openpyxl"], "external_methods": ["load_workbook", "psycopg.connect"], "published": ["run"], "classes": [{"name": "TableCounts", "description": "Tracks the number of inserted, updated, and skipped rows for database tables during ingestion."}, {"name": "FileReport", "description": "Records the results of processing a single input file, including counts per table."}], "methods": [{"name": "str _ensure_ssl_and_channel_binding(dsn: str)", "description": "Ensures the database DSN includes sslmode=require and channel_binding=require parameters.", "scope": "", "scopeKind": ""}, {"name": "datetime _now_utc()", "description": "Returns the current UTC datetime with timezone info.", "scope": "", "scopeKind": ""}, {"name": "bool _is_missing(v: Any)", "description": "Checks if a value is None, empty, or NaN.", "scope": "", "scopeKind": ""}, {"name": "str _snake(s: str)", "description": "Converts a string to snake_case for headers.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _provider_from_filename(name: str)", "description": "Infers provider type from filename content.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _normalize_provider(v: Any)", "description": "Normalizes provider strings to lowercase standard forms like 'aws', 'azure', 'gcp'.", "scope": "", "scopeKind": ""}, {"name": "str _normalize_priority(v: Any)", "description": "Normalizes priority values to predefined set, defaulting to 'medium'.", "scope": "", "scopeKind": ""}, {"name": "Optional[datetime] _parse_datetime(v: Any)", "description": "Parses datetime values from strings or datetime objects.", "scope": "", "scopeKind": ""}, {"name": "Optional[Decimal] _to_decimal_or_none(v: Any)", "description": "Converts a value to Decimal or returns None.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,str] _parse_tags(v: Any)", "description": "Parses tag data from dicts or comma-separated key:value strings.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] _read_xlsx_rows(path: Path)", "description": "Reads XLSX file into a list of dicts with snake_case headers.", "scope": "", "scopeKind": ""}, {"name": "bool _table_exists(conn: psycopg.Connection, table: str)", "description": "Checks if a table exists in the PostgreSQL database.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,bool] _upsert_org(conn: psycopg.Connection, name: str, slug: str)", "description": "Inserts or updates an organization record; returns ID and insertion status.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,bool] _upsert_cloud_account( conn: psycopg.Connection, *, organization_id: str, provider: str, account_external_id: str, account_name: str, )", "description": "Inserts or updates cloud account info; returns ID and insertion status.", "scope": "", "scopeKind": ""}, {"name": "str _stable_recommendation_uuid( organization_id: str, provider: str, recommendation_id: Any, row: Dict[str, Any] )", "description": "Generates a deterministic UUID for recommendations based on key fields.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _find_resource_internal_id( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, external_resource_id: str, )", "description": "Finds the internal UUID for a resource based on its external ID and provider context.", "scope": "", "scopeKind": ""}, {"name": "FileReport _ingest_resources_xlsx( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, path: Path, has_resource_costs_daily: bool, )", "description": "Processes resources XLSX files, upserting data into resources and resource_costs_daily tables.", "scope": "", "scopeKind": ""}, {"name": "FileReport _ingest_recommendations_xlsx( conn: psycopg.Connection, *, organization_id: str, cloud_account_ids: Dict[str, str], path: Path, )", "description": "Processes recommendations XLSX files, inserting or updating recommendations.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,TableCounts] _sum_table_counts(reports: Iterable[FileReport])", "description": "Aggregates counts from multiple FileReport objects.", "scope": "", "scopeKind": ""}, {"name": "str _render_markdown_report( *, started_at: datetime, finished_at: datetime, database_url: str, org: Dict[str, Any], lookups: Dict[str, TableCounts], file_reports: List[FileReport], totals: Dict[str, TableCounts], )", "description": "Generates a formatted markdown report summarizing the ingestion process.", "scope": "", "scopeKind": ""}, {"name": "int run()", "description": "Main CLI entrypoint; orchestrates ingestion of files and report generation.", "scope": "", "scopeKind": ""}, {"name": "str _row(table: str, c: TableCounts)", "scope": "_render_markdown_report", "scopeKind": "function", "description": "unavailable"}], "calls": ["load_workbook", "psycopg.connect", "_ensure_ssl_and_channel_binding", "_now_utc", "_is_missing", "_snake", "_provider_from_filename", "_normalize_provider", "_normalize_priority", "_parse_datetime", "_to_decimal_or_none", "_parse_tags", "_read_xlsx_rows", "_table_exists", "_upsert_org", "_upsert_cloud_account", "_stable_recommendation_uuid", "_find_resource_internal_id", "_ingest_resources_xlsx", "_ingest_recommendations_xlsx", "_sum_table_counts", "_render_markdown_report"], "search-terms": ["ingest_step2_2_to_2_5", "cloud resources ingestion", "Neon PostgreSQL", "xlsx processing", "recommendations ingestion", "resource_costs_daily", "recommendations", "cloud accounts", "organization management", "report generation"], "state": 2, "file_id": 44, "knowledge_revision": 129, "git_revision": "3f065c9d5471e043ec358da4fd501f435cc3cd8c", "ctags": [{"_type": "tag", "name": "FileReport", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^class FileReport:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "NAMESPACE_RECOMMENDATION", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^NAMESPACE_RECOMMENDATION = uuid.UUID(\"1d4ab8e8-0d5e-4c1a-9a41-2a30f1a34a2c\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PRIORITIES", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^PRIORITIES = {\"low\", \"medium\", \"high\", \"critical\"}$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PROVIDERS", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^PROVIDERS = (\"aws\", \"azure\", \"gcp\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TableCounts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^class TableCounts:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_ensure_ssl_and_channel_binding", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _ensure_ssl_and_channel_binding(dsn: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(dsn: str)"}, {"_type": "tag", "name": "_find_resource_internal_id", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _find_resource_internal_id($/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, external_resource_id: str, )"}, {"_type": "tag", "name": "_ingest_recommendations_xlsx", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _ingest_recommendations_xlsx($/", "language": "Python", "typeref": "typename:FileReport", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, cloud_account_ids: Dict[str, str], path: Path, )"}, {"_type": "tag", "name": "_ingest_resources_xlsx", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _ingest_resources_xlsx($/", "language": "Python", "typeref": "typename:FileReport", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, provider: str, cloud_account_id: str, path: Path, has_resource_costs_daily: bool, )"}, {"_type": "tag", "name": "_is_missing", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _is_missing(v: Any) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_normalize_priority", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _normalize_priority(v: Any) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_normalize_provider", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _normalize_provider(v: Any) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_now_utc", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _now_utc() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_parse_datetime", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _parse_datetime(v: Any) -> Optional[datetime]:$/", "language": "Python", "typeref": "typename:Optional[datetime]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_parse_tags", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _parse_tags(v: Any) -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_provider_from_filename", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _provider_from_filename(name: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_read_xlsx_rows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _read_xlsx_rows(path: Path) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(path: Path)"}, {"_type": "tag", "name": "_render_markdown_report", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _render_markdown_report($/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "( *, started_at: datetime, finished_at: datetime, database_url: str, org: Dict[str, Any], lookups: Dict[str, TableCounts], file_reports: List[FileReport], totals: Dict[str, TableCounts], )"}, {"_type": "tag", "name": "_row", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    def _row(table: str, c: TableCounts) -> str:$/", "file": true, "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(table: str, c: TableCounts)", "scope": "_render_markdown_report", "scopeKind": "function"}, {"_type": "tag", "name": "_snake", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _snake(s: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(s: str)"}, {"_type": "tag", "name": "_stable_recommendation_uuid", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _stable_recommendation_uuid($/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "( organization_id: str, provider: str, recommendation_id: Any, row: Dict[str, Any] )"}, {"_type": "tag", "name": "_sum_table_counts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _sum_table_counts(reports: Iterable[FileReport]) -> Dict[str, TableCounts]:$/", "language": "Python", "typeref": "typename:Dict[str,TableCounts]", "kind": "function", "signature": "(reports: Iterable[FileReport])"}, {"_type": "tag", "name": "_table_exists", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _table_exists(conn: psycopg.Connection, table: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(conn: psycopg.Connection, table: str)"}, {"_type": "tag", "name": "_to_decimal_or_none", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _to_decimal_or_none(v: Any) -> Optional[Decimal]:$/", "language": "Python", "typeref": "typename:Optional[Decimal]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_upsert_cloud_account", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _upsert_cloud_account($/", "language": "Python", "typeref": "typename:Tuple[str,bool]", "kind": "function", "signature": "( conn: psycopg.Connection, *, organization_id: str, provider: str, account_external_id: str, account_name: str, )"}, {"_type": "tag", "name": "_upsert_org", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def _upsert_org(conn: psycopg.Connection, name: str, slug: str) -> Tuple[str, bool]:$/", "language": "Python", "typeref": "typename:Tuple[str,bool]", "kind": "function", "signature": "(conn: psycopg.Connection, name: str, slug: str)"}, {"_type": "tag", "name": "inserted", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    inserted: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TableCounts", "scopeKind": "class"}, {"_type": "tag", "name": "run", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^def run() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "skipped", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    skipped: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TableCounts", "scopeKind": "class"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_step2_2_to_2_5.py", "pattern": "/^    updated: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TableCounts", "scopeKind": "class"}], "hash": "6719dae5e6c0de2627ec33d9c9e56440", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/scripts/ingest_step2_2_to_2_5.py", "fields": [{"name": "NAMESPACE_RECOMMENDATION = uuid.UUID(\"1d4ab8e8-0d5e-4c1a-9a41-2a30f1a34a2c\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PRIORITIES = {\"low\", \"medium\", \"high\", \"critical\"}", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PROVIDERS = (\"aws\", \"azure\", \"gcp\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int inserted", "scope": "TableCounts", "scopeKind": "class", "description": "unavailable"}, {"name": "int skipped", "scope": "TableCounts", "scopeKind": "class", "description": "unavailable"}, {"name": "int updated", "scope": "TableCounts", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"129": "3f065c9d5471e043ec358da4fd501f435cc3cd8c"}]}