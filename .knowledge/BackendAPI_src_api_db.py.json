{"is_source_file": true, "format": "Python", "description": "This file is a Python module that manages database initialization and session handling for a project using SQLAlchemy's async features. It configures the database engine, handles migrations via Alembic, and provides functions to obtain database sessions. It also defines a declarative base for models.", "external_files": ["os", "logging", "sqlalchemy.ext.asyncio", "sqlalchemy.orm", "sqlalchemy", "alembic"], "external_methods": ["alembic.command.upgrade", "alembic.config.Config"], "published": ["get_session", "init_db", "get_database_url"], "classes": [{"name": "Base", "description": "Declarative base class for all ORM models in the project."}], "methods": [{"name": "str get_database_url()", "description": "Determines the database URL based on environment variables, defaulting to a local SQLite database for development.", "scope": "", "scopeKind": ""}, {"name": "AsyncGenerator[AsyncSession,None] get_session()", "description": "Asynchronous generator function that yields a SQLAlchemy AsyncSession, managing connection lifecycle.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_engine()", "description": "Initializes the SQLAlchemy AsyncEngine and session factory if they are not already created.", "scope": "", "scopeKind": ""}, {"name": "None _run_alembic_migrations()", "description": "Executes Alembic migrations programmatically to upgrade the database schema to the latest head.", "scope": "", "scopeKind": ""}, {"name": "None init_db()", "description": "Initializes the database schema; creates tables directly for SQLite or runs migrations for other databases, with fallback mechanisms.", "scope": "", "scopeKind": ""}], "calls": ["create_async_engine", "async_sessionmaker", "async_sessionmaker._call_", "logger.info", "logger.warning", "os.getenv", "text", "alembic.command.upgrade", "alembic.config.Config", "os.path.abspath", "os.path.dirname", "os.path.join", "os.path.exists", "asyncio.run", [null, 0], {"line": 205, "character": 10}], "search-terms": ["async SQLAlchemy engine", "Alembic migration handling", "database session generator", "declarative base", "configure database URL", "apply migrations", "initialize database schema"], "state": 2, "file_id": 5, "knowledge_revision": 39, "git_revision": "878ec2ea2b1f0d16f6a5088caba9c392e29b3612", "revision_history": [{"19": ""}, {"39": "878ec2ea2b1f0d16f6a5088caba9c392e29b3612"}], "ctags": [{"_type": "tag", "name": "Base", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/db.py", "pattern": "/^Base = declarative_base()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_ensure_engine", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/db.py", "pattern": "/^def _ensure_engine() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_run_alembic_migrations", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/db.py", "pattern": "/^def _run_alembic_migrations() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_database_url", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/db.py", "pattern": "/^def get_database_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_session", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/db.py", "pattern": "/^async def get_session() -> AsyncGenerator[AsyncSession, None]:$/", "language": "Python", "typeref": "typename:AsyncGenerator[AsyncSession,None]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "init_db", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/db.py", "pattern": "/^async def init_db() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/db.py", "pattern": "/^logger = logging.getLogger(\"cloudunify.db\")$/", "language": "Python", "kind": "variable"}], "hash": "6c422770bae395fbb47adbacad6ea817", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/src/api/db.py", "fields": [{"name": "Base = declarative_base()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(\"cloudunify.db\")", "scope": "", "scopeKind": "", "description": "unavailable"}]}