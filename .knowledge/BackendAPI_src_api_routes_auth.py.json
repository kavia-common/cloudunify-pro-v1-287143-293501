{"is_source_file": true, "format": "Python", "description": "This is a Python source file defining API routes related to authentication for a web backend, including login, current user retrieval, and admin testing endpoints. It uses FastAPI, SQLAlchemy, and Pydantic.", "external_files": ["src.api.db", "src.api.models", "src.api.security"], "external_methods": ["get_session", "verify_password", "create_access_token", "create_refresh_token", "require_roles", "get_current_user"], "published": ["login", "get_me", "admin_ping"], "classes": [{"name": "LoginRequest", "description": "Pydantic model representing the login request payload with email and password."}, {"name": "LoginResponse", "description": "Pydantic model for the response containing JWT tokens after successful login."}, {"name": "UserPublic", "description": "Pydantic model representing the publicly visible user profile."}], "methods": [{"name": "bool _truthy(value: Optional[str])", "description": "Helper function to interpret a string as a boolean.", "scope": "", "scopeKind": ""}, {"name": "bool _auth_log_enabled()", "description": "Determines if auth failure logging is enabled based on environment variables.", "scope": "", "scopeKind": ""}, {"name": "LoginResponse login(payload: LoginRequest, session: AsyncSession = Depends(get_session))", "description": "API endpoint to authenticate a user and provide JWT tokens.", "scope": "", "scopeKind": ""}, {"name": "UserPublic get_me( user=Depends(get_current_user), session: AsyncSession = Depends(get_session), )", "description": "API endpoint to retrieve current authenticated user's public profile.", "scope": "", "scopeKind": ""}, {"name": "admin_ping(_=Depends(require_roles(Role.admin)))", "description": "Endpoint for admin role to verify RBAC functionality.", "scope": "", "scopeKind": ""}], "calls": ["select(User).where(func.lower(User.email) == normalized_email)", "session.execute", "verify_password(payload.password, user.hashed_password)", "create_access_token(user_id=user.id, role=user.role)", "create_refresh_token(user_id=user.id, role=user.role)", "get_current_user", "require_roles(Role.admin)"], "search-terms": ["auth.py", "FastAPI routes", "JWT token", "login", "session", "User", "RBAC", "admin endpoint"], "state": 2, "file_id": 19, "knowledge_revision": 102, "git_revision": "378e982de5aa6f5f944521eac338a56dd4d39372", "revision_history": [{"50": "06a422bc83e613264740ebb974dc8855dceb4a35"}, {"102": "378e982de5aa6f5f944521eac338a56dd4d39372"}], "ctags": [{"_type": "tag", "name": "LoginRequest", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^class LoginRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LoginResponse", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^class LoginResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserPublic", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^class UserPublic(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_auth_log_enabled", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^def _auth_log_enabled() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_log", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^_log = logging.getLogger(\"cloudunify.auth\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_truthy", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^def _truthy(value: Optional[str]) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(value: Optional[str])"}, {"_type": "tag", "name": "access_token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    access_token: str = Field(..., description=\"Short-lived access token (JWT)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginResponse", "scopeKind": "class"}, {"_type": "tag", "name": "admin_ping", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^async def admin_ping(_=Depends(require_roles(Role.admin))):$/", "language": "Python", "kind": "function", "signature": "(_=Depends(require_roles(Role.admin)))"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    email: EmailStr = Field(..., description=\"User email address\")$/", "language": "Python", "typeref": "typename:EmailStr", "kind": "variable", "scope": "LoginRequest", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    email: EmailStr = Field(..., description=\"User email\")$/", "language": "Python", "typeref": "typename:EmailStr", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "get_me", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^async def get_me($/", "language": "Python", "typeref": "typename:UserPublic", "kind": "function", "signature": "( user=Depends(get_current_user), session: AsyncSession = Depends(get_session), )"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    id: str = Field(..., description=\"User ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "is_active", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    is_active: bool = Field(..., description=\"Whether the user is active\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^async def login(payload: LoginRequest, session: AsyncSession = Depends(get_session)) -> LoginRes/", "language": "Python", "typeref": "typename:LoginResponse", "kind": "function", "signature": "(payload: LoginRequest, session: AsyncSession = Depends(get_session))"}, {"_type": "tag", "name": "password", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    password: str = Field(..., description=\"User password (plaintext)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginRequest", "scopeKind": "class"}, {"_type": "tag", "name": "refresh_token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    refresh_token: str = Field(..., description=\"Long-lived refresh token (JWT)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginResponse", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    role: str = Field(..., description=\"User global role\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "token_type", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    token_type: str = Field(\"bearer\", description=\"Token type (bearer)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginResponse", "scopeKind": "class"}], "hash": "948b23c3c1406b3f77b8bce837aef38c", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/src/api/routes/auth.py", "fields": [{"name": "_log = logging.getLogger(\"cloudunify.auth\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str access_token", "scope": "LoginResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "EmailStr email", "scope": "LoginRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str id", "scope": "UserPublic", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_active", "scope": "UserPublic", "scopeKind": "class", "description": "unavailable"}, {"name": "str password", "scope": "LoginRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str refresh_token", "scope": "LoginResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str role", "scope": "UserPublic", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str token_type", "scope": "LoginResponse", "scopeKind": "class", "description": "unavailable"}]}