{"is_source_file": true, "format": "Python", "description": "This is a Python source file implementing authentication routes for a web API using FastAPI. It includes user registration, login, profile retrieval, and an admin-only ping endpoint. The file defines data models, helper functions, and route handlers related to user authentication and authorization.", "external_files": ["src.api.db", "src.api.models", "src.api.security"], "external_methods": ["get_session", "get_password_hash", "verify_password", "create_access_token", "create_refresh_token", "require_roles", "get_current_user"], "published": ["router"], "classes": [{"name": "LoginRequest", "description": "Represents the payload for login requests containing email and password."}, {"name": "LoginResponse", "description": "Represents the JWT token pair response after successful login."}, {"name": "UserPublic", "description": "Public view of a user, exposed via API endpoints."}, {"name": "RegisterRequest", "description": "Payload for user registration containing username, email, and password."}], "methods": [{"name": "bool _truthy(value: Optional[str])", "description": "Helper function to interpret environment variable values as booleans.", "scope": "", "scopeKind": ""}, {"name": "bool _auth_log_enabled()", "description": "Determines if minimal authentication failure logs should be enabled based on environment variables.", "scope": "", "scopeKind": ""}, {"name": "UserPublic register(payload: RegisterRequest, session: AsyncSession = Depends(get_session))", "description": "API endpoint for user registration, creating a new user if validations pass.", "scope": "", "scopeKind": ""}, {"name": "LoginResponse login(payload: LoginRequest, session: AsyncSession = Depends(get_session))", "description": "API endpoint for user authentication, returning tokens upon success.", "scope": "", "scopeKind": ""}, {"name": "UserPublic get_me( user=Depends(get_current_user), session: AsyncSession = Depends(get_session), )", "description": "API endpoint to fetch current authenticated user's public profile.", "scope": "", "scopeKind": ""}, {"name": "admin_ping(_=Depends(require_roles(Role.admin)))", "description": "Admin-only test endpoint to verify role-based access control.", "scope": "", "scopeKind": ""}], "calls": ["select(User).where(func.lower(User.email) == ...)", "select(User).where(func.lower(User.username) == ...)", "session.add(user)", "session.commit()", "session.refresh(user)", "session.execute(...)"], "search-terms": ["auth routes", "FastAPI auth", "user registration", "JWT login", "admin ping", "role-based access control", "user profile"], "state": 2, "file_id": 19, "knowledge_revision": 140, "git_revision": "41043e0e28c819cc3f4ebaa2f26cb85a5ce2f254", "revision_history": [{"50": "06a422bc83e613264740ebb974dc8855dceb4a35"}, {"102": "378e982de5aa6f5f944521eac338a56dd4d39372"}, {"109": "41043e0e28c819cc3f4ebaa2f26cb85a5ce2f254"}, {"140": "41043e0e28c819cc3f4ebaa2f26cb85a5ce2f254"}], "ctags": [{"_type": "tag", "name": "LoginRequest", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^class LoginRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LoginResponse", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^class LoginResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "RegisterRequest", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^class RegisterRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserPublic", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^class UserPublic(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_auth_log_enabled", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^def _auth_log_enabled() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_log", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^_log = logging.getLogger(\"cloudunify.auth\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_truthy", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^def _truthy(value: Optional[str]) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(value: Optional[str])"}, {"_type": "tag", "name": "access_token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    access_token: str = Field(..., description=\"Short-lived access token (JWT)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginResponse", "scopeKind": "class"}, {"_type": "tag", "name": "admin_ping", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^async def admin_ping(_=Depends(require_roles(Role.admin))):$/", "language": "Python", "kind": "function", "signature": "(_=Depends(require_roles(Role.admin)))"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    email: EmailStr = Field(..., description=\"User email address\")$/", "language": "Python", "typeref": "typename:EmailStr", "kind": "variable", "scope": "LoginRequest", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    email: EmailStr = Field(..., description=\"User email address\")$/", "language": "Python", "typeref": "typename:EmailStr", "kind": "variable", "scope": "RegisterRequest", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    email: EmailStr = Field(..., description=\"User email\")$/", "language": "Python", "typeref": "typename:EmailStr", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "get_me", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^async def get_me($/", "language": "Python", "typeref": "typename:UserPublic", "kind": "function", "signature": "( user=Depends(get_current_user), session: AsyncSession = Depends(get_session), )"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    id: str = Field(..., description=\"User ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "is_active", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    is_active: bool = Field(..., description=\"Whether the user is active\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^async def login(payload: LoginRequest, session: AsyncSession = Depends(get_session)) -> LoginRes/", "language": "Python", "typeref": "typename:LoginResponse", "kind": "function", "signature": "(payload: LoginRequest, session: AsyncSession = Depends(get_session))"}, {"_type": "tag", "name": "password", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    password: str = Field(..., description=\"User password (plaintext)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginRequest", "scopeKind": "class"}, {"_type": "tag", "name": "password", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    password: str = Field(..., min_length=8, description=\"User password (min 8 characters)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "RegisterRequest", "scopeKind": "class"}, {"_type": "tag", "name": "refresh_token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    refresh_token: str = Field(..., description=\"Long-lived refresh token (JWT)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginResponse", "scopeKind": "class"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^async def register(payload: RegisterRequest, session: AsyncSession = Depends(get_session)) -> Us/", "language": "Python", "typeref": "typename:UserPublic", "kind": "function", "signature": "(payload: RegisterRequest, session: AsyncSession = Depends(get_session))"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    role: str = Field(..., description=\"User global role\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserPublic", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "token_type", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    token_type: str = Field(\"bearer\", description=\"Token type (bearer)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginResponse", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/routes/auth.py", "pattern": "/^    username: str = Field(..., min_length=2, description=\"Desired username (min 2 characters)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "RegisterRequest", "scopeKind": "class"}], "hash": "ced503959e865a97a019b048277785da", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/src/api/routes/auth.py", "fields": [{"name": "_log = logging.getLogger(\"cloudunify.auth\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str access_token", "scope": "LoginResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "EmailStr email", "scope": "LoginRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str id", "scope": "UserPublic", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_active", "scope": "UserPublic", "scopeKind": "class", "description": "unavailable"}, {"name": "str password", "scope": "LoginRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str refresh_token", "scope": "LoginResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str role", "scope": "UserPublic", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str token_type", "scope": "LoginResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "RegisterRequest", "scopeKind": "class", "description": "unavailable"}]}