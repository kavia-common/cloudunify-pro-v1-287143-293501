{"is_source_file": true, "format": "Python", "description": "This test source file validates WebSocket and REST API endpoints related to activity streams in a FastAPI application. It includes user setup, login, WebSocket connection handling, and resource ingestion tests.", "external_files": ["src.api.main", "src.api.models", "src.api.security"], "external_methods": ["get_password_hash", "client.post", "client.websocket_connect"], "published": [], "classes": [], "methods": [{"name": "_ensure_user(email: str, password: str, role: str = \"user\")", "description": "Asynchronously creates a user in the database if not already present.", "scope": "", "scopeKind": ""}, {"name": "str _login(email: str, password: str)", "description": "Performs login to retrieve an access token for the user.", "scope": "", "scopeKind": ""}, {"name": "test_websocket_auth_required()", "description": "Tests that connecting to the WebSocket endpoint without a token fails as expected.", "scope": "", "scopeKind": ""}, {"name": "test_websocket_broadcast_on_resource_ingest()", "description": "Tests the full flow of user creation, login, WebSocket connection, resource ingestion, and broadcast of activity event.", "scope": "", "scopeKind": ""}], "calls": ["create_async_engine", "async_sessionmaker", "session.execute", "session.add", "session.commit", "client.post", "client.websocket_connect", "ws.receive_json"], "search-terms": ["WebSocket activity stream", "FastAPI WebSocket test", "user creation in tests", "resource ingestion test", "Async SQLAlchemy test setup"], "state": 2, "file_id": 33, "knowledge_revision": 84, "git_revision": "663e484f4e351dd8c26eabaf0c08fd31ad09b7f7", "ctags": [{"_type": "tag", "name": "TEST_EMAIL", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_ws_activity.py", "pattern": "/^TEST_EMAIL = \"ws-user@example.com\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TEST_PASSWORD", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_ws_activity.py", "pattern": "/^TEST_PASSWORD = \"Sup3rSecret!\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_ensure_user", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_ws_activity.py", "pattern": "/^async def _ensure_user(email: str, password: str, role: str = \"user\"):$/", "language": "Python", "kind": "function", "signature": "(email: str, password: str, role: str = \"user\")"}, {"_type": "tag", "name": "_login", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_ws_activity.py", "pattern": "/^def _login(email: str, password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(email: str, password: str)"}, {"_type": "tag", "name": "client", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_ws_activity.py", "pattern": "/^client = TestClient(app)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "test_websocket_auth_required", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_ws_activity.py", "pattern": "/^def test_websocket_auth_required():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "test_websocket_broadcast_on_resource_ingest", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/tests/test_ws_activity.py", "pattern": "/^def test_websocket_broadcast_on_resource_ingest():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "bdb1b683edab994a06b4a3618d52cfc8", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/tests/test_ws_activity.py", "fields": [{"name": "TEST_EMAIL = \"ws-user@example.com\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TEST_PASSWORD = \"Sup3rSecret!\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "client = TestClient(app)", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"84": "663e484f4e351dd8c26eabaf0c08fd31ad09b7f7"}]}