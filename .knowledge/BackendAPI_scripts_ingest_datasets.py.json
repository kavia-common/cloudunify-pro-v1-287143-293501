{"is_source_file": true, "format": "Python", "description": "This script is a Python utility for ingesting datasets (specifically Excel files containing resource and recommendation data) into a PostgreSQL database, as part of the CloudUnify Pro project. It reads Excel files, parses and normalizes the data, and performs idempotent upserts into resources and recommendations tables, with configuration options for organization, cloud accounts, input directory, and dry run mode.", "external_files": ["psycopg", "openpyxl", "dotenv"], "external_methods": ["psycopg.connect", "load_workbook", "load_dotenv"], "published": ["run"], "classes": [{"name": "IngestConfig", "description": "Immutable configuration data class storing organization ID, cloud account mappings, database connection string, input directory, and dry run flag."}], "methods": [{"name": "Tuple[List[Path],List[Path]] discover_input_files(input_dir: Path)", "description": "Discover and categorize Excel files in the input directory into resource files and recommendation files.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] _read_excel_rows(path: Path)", "description": "Read rows from an Excel file, returning list of dictionaries keyed by normalized headers.", "scope": "", "scopeKind": ""}, {"name": "Optional[Path] _resolve_repo_root(start: Path)", "description": "Walk upward from a start directory to find the repo root containing 'attachments' as a subdirectory.", "scope": "", "scopeKind": ""}, {"name": "Optional[Any] _fetch_one_scalar(conn: psycopg.Connection, query: str, params: Tuple[Any, ...])", "description": "Execute a scalar SQL query and return the first column of the first row.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,Dict[str,str]] _resolve_org_and_accounts(conn: psycopg.Connection, args: argparse.Namespace, providers_needed: Iterable[str])", "description": "Determine organization ID and cloud account IDs based on provided arguments or auto-detection from database.", "scope": "", "scopeKind": ""}, {"name": "Tuple[int,int,int] _ingest_resources_file(conn: psycopg.Connection, cfg: IngestConfig, path: Path)", "description": "Parse and insert/update resource data from an Excel file into the database.", "scope": "", "scopeKind": ""}, {"name": "Tuple[int,int,int] _ingest_recommendations_file(conn: psycopg.Connection, cfg: IngestConfig, path: Path)", "description": "Parse and insert/update recommendation data from an Excel file into the database.", "scope": "", "scopeKind": ""}, {"name": "int run()", "description": "Main CLI entry point that parses arguments, discovers files, establishes database connection, and orchestrates ingestion of resource and recommendation files, with logging and summary output.", "scope": "", "scopeKind": ""}, {"name": "str _ensure_ssl_and_channel_binding(dsn: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str _normalize_priority(v: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] _normalize_provider(v: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "datetime _now_utc()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[datetime] _parse_datetime_or_none(v: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,str] _parse_tags(s: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] _provider_from_filename(name: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str _snake(s: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[Decimal] _to_decimal_or_none(v: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "None load_dotenv(*args: Any, **kwargs: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["psycopg.connect", "load_workbook", "_read_excel_rows", "_resolve_repo_root", "_resolve_org_and_accounts", "_ingest_resources_file", "_ingest_recommendations_file"], "search-terms": ["ingest_datasets.py", "CloudUnify Pro", "Excel datasets ingestion", "resources", "recommendations", "idempotent upsert", "Postgres", "CSV parsing", "resource resource_id", "recommendation recommendation_id", "Python data load utility"], "state": 2, "file_id": 40, "knowledge_revision": 119, "git_revision": "adefce0979a1182ea86cf43f1298563fa22d1fff", "revision_history": [{"117": ""}, {"119": "adefce0979a1182ea86cf43f1298563fa22d1fff"}], "ctags": [{"_type": "tag", "name": "FALLBACK_NEON_DSN", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^FALLBACK_NEON_DSN = \"postgresql:\\/\\/USER:PASSWORD@HOST:PORT\\/DBNAME?sslmode=require\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "IngestConfig", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^class IngestConfig:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PRIORITY_ALLOWED", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^PRIORITY_ALLOWED = {\"low\", \"medium\", \"high\", \"critical\"}$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PROVIDER_SLUGS", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^PROVIDER_SLUGS = {\"aws\", \"azure\", \"gcp\"}$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SQL_FIND_RESOURCE_INTERNAL_ID", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^SQL_FIND_RESOURCE_INTERNAL_ID = \"\"\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SQL_UPSERT_RECOMMENDATION", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^SQL_UPSERT_RECOMMENDATION = \"\"\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SQL_UPSERT_RESOURCE", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^SQL_UPSERT_RESOURCE = \"\"\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_ensure_ssl_and_channel_binding", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _ensure_ssl_and_channel_binding(dsn: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(dsn: str)"}, {"_type": "tag", "name": "_fetch_one_scalar", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _fetch_one_scalar(conn: psycopg.Connection, query: str, params: Tuple[Any, ...]) -> Optional/", "language": "Python", "typeref": "typename:Optional[Any]", "kind": "function", "signature": "(conn: psycopg.Connection, query: str, params: Tuple[Any, ...])"}, {"_type": "tag", "name": "_ingest_recommendations_file", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _ingest_recommendations_file(conn: psycopg.Connection, cfg: IngestConfig, path: Path) -> Tup/", "language": "Python", "typeref": "typename:Tuple[int,int,int]", "kind": "function", "signature": "(conn: psycopg.Connection, cfg: IngestConfig, path: Path)"}, {"_type": "tag", "name": "_ingest_resources_file", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _ingest_resources_file(conn: psycopg.Connection, cfg: IngestConfig, path: Path) -> Tuple[int/", "language": "Python", "typeref": "typename:Tuple[int,int,int]", "kind": "function", "signature": "(conn: psycopg.Connection, cfg: IngestConfig, path: Path)"}, {"_type": "tag", "name": "_normalize_priority", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _normalize_priority(v: Any) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_normalize_provider", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _normalize_provider(v: Any) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_now_utc", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _now_utc() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_parse_datetime_or_none", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _parse_datetime_or_none(v: Any) -> Optional[datetime]:$/", "language": "Python", "typeref": "typename:Optional[datetime]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "_parse_tags", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _parse_tags(s: Any) -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "(s: Any)"}, {"_type": "tag", "name": "_provider_from_filename", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _provider_from_filename(name: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_read_excel_rows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _read_excel_rows(path: Path) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(path: Path)"}, {"_type": "tag", "name": "_resolve_org_and_accounts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _resolve_org_and_accounts(conn: psycopg.Connection, args: argparse.Namespace, providers_need/", "language": "Python", "typeref": "typename:Tuple[str,Dict[str,str]]", "kind": "function", "signature": "(conn: psycopg.Connection, args: argparse.Namespace, providers_needed: Iterable[str])"}, {"_type": "tag", "name": "_resolve_repo_root", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _resolve_repo_root(start: Path) -> Optional[Path]:$/", "language": "Python", "typeref": "typename:Optional[Path]", "kind": "function", "signature": "(start: Path)"}, {"_type": "tag", "name": "_snake", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _snake(s: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(s: str)"}, {"_type": "tag", "name": "_to_decimal_or_none", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def _to_decimal_or_none(v: Any) -> Optional[Decimal]:$/", "language": "Python", "typeref": "typename:Optional[Decimal]", "kind": "function", "signature": "(v: Any)"}, {"_type": "tag", "name": "discover_input_files", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def discover_input_files(input_dir: Path) -> Tuple[List[Path], List[Path]]:$/", "language": "Python", "typeref": "typename:Tuple[List[Path],List[Path]]", "kind": "function", "signature": "(input_dir: Path)"}, {"_type": "tag", "name": "dry_run", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^    dry_run: bool = False$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "IngestConfig", "scopeKind": "class"}, {"_type": "tag", "name": "handler", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^handler = logging.StreamHandler(sys.stdout)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "load_dotenv", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^    def load_dotenv(*args: Any, **kwargs: Any) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(*args: Any, **kwargs: Any)"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^logger = logging.getLogger(\"cloudunify.scripts.ingest\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "run", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/scripts/ingest_datasets.py", "pattern": "/^def run() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}], "hash": "16f1aac178e008a411e5bc625f6fba5f", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/scripts/ingest_datasets.py", "fields": [{"name": "FALLBACK_NEON_DSN = \"postgresql:\\/\\/USER:PASSWORD@HOST:PORT\\/DBNAME?sslmode=require\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PRIORITY_ALLOWED = {\"low\", \"medium\", \"high\", \"critical\"}", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PROVIDER_SLUGS = {\"aws\", \"azure\", \"gcp\"}", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SQL_FIND_RESOURCE_INTERNAL_ID = \"\"\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SQL_UPSERT_RECOMMENDATION = \"\"\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SQL_UPSERT_RESOURCE = \"\"\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool dry_run", "scope": "IngestConfig", "scopeKind": "class", "description": "unavailable"}, {"name": "handler = logging.StreamHandler(sys.stdout)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(\"cloudunify.scripts.ingest\")", "scope": "", "scopeKind": "", "description": "unavailable"}]}