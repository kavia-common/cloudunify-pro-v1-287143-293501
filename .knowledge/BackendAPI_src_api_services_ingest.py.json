{"is_source_file": true, "format": "Python", "description": "This file contains utility functions and asynchronous procedures for bulk upserting resources and costs into a database, with support for dialect-specific insert statements and conflict resolution strategies.", "external_files": ["src.api.models", "src.api.schemas", "sqlalchemy", "sqlalchemy.ext.asyncio"], "external_methods": ["session.get_bind", "session.execute", "func.current_timestamp", "select", "tuple_"], "published": ["bulk_upsert_resources", "bulk_upsert_costs"], "classes": [], "methods": [{"name": "_dialect_insert(session: AsyncSession, model)", "description": "Returns a dialect-specific insert statement based on the database dialect to support conflict handling.", "scope": "", "scopeKind": ""}, {"name": "Iterable[Sequence] _chunked(seq: Sequence, size: int)", "description": "Splits a sequence into chunks of specified size for batch processing.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,str,str] _resource_key_tuple(r: ResourceIngestRow)", "description": "Creates a tuple key from ResourceIngestRow for identifying resource uniqueness.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,str,str,str,str,date] _cost_key_tuple(c: CostIngestRow)", "description": "Creates a tuple key from CostIngestRow for identifying cost record uniqueness.", "scope": "", "scopeKind": ""}, {"name": "set[Tuple[str,str,str]] _existing_resource_keys(session: AsyncSession, keys: List[Tuple[str, str, str]])", "description": "Queries the database to find existing resource keys in batches.", "scope": "", "scopeKind": ""}, {"name": "set[Tuple[str,str,str,str,str,date]] _existing_cost_keys( session: AsyncSession, keys: List[Tuple[str, str, str, str, str, date]] )", "description": "Queries the database to find existing cost record keys in batches.", "scope": "", "scopeKind": ""}, {"name": "tuple[int,int] bulk_upsert_resources(session: AsyncSession, rows: List[ResourceIngestRow])", "description": "Performs bulk upsert of resource data, inserting new records and updating existing ones.", "scope": "", "scopeKind": ""}, {"name": "tuple[int,int] bulk_upsert_costs(session: AsyncSession, rows: List[CostIngestRow])", "description": "Performs bulk upsert of cost data, replacing existing records on conflict.", "scope": "", "scopeKind": ""}], "calls": ["session.get_bind", "session.execute", "select", "tuple_", "func.current_timestamp"], "search-terms": ["bulk_upsert", "ResourceIngestRow", "CostIngestRow", "dialect-specific insert", "Conflict handling", "asyncio database operations", "resource and cost key tuples"], "state": 2, "file_id": 9, "knowledge_revision": 30, "git_revision": "479946a94985ba88eadab5a6948c8d4739635860", "revision_history": [{"23": ""}, {"30": "479946a94985ba88eadab5a6948c8d4739635860"}], "ctags": [{"_type": "tag", "name": "_chunked", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^def _chunked(seq: Sequence, size: int) -> Iterable[Sequence]:$/", "language": "Python", "typeref": "typename:Iterable[Sequence]", "kind": "function", "signature": "(seq: Sequence, size: int)"}, {"_type": "tag", "name": "_cost_key_tuple", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^def _cost_key_tuple(c: CostIngestRow) -> Tuple[str, str, str, str, str, date]:$/", "language": "Python", "typeref": "typename:Tuple[str,str,str,str,str,date]", "kind": "function", "signature": "(c: CostIngestRow)"}, {"_type": "tag", "name": "_dialect_insert", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^def _dialect_insert(session: AsyncSession, model):$/", "language": "Python", "kind": "function", "signature": "(session: AsyncSession, model)"}, {"_type": "tag", "name": "_existing_cost_keys", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def _existing_cost_keys($/", "language": "Python", "typeref": "typename:set[Tuple[str,str,str,str,str,date]]", "kind": "function", "signature": "( session: AsyncSession, keys: List[Tuple[str, str, str, str, str, date]] )"}, {"_type": "tag", "name": "_existing_resource_keys", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def _existing_resource_keys(session: AsyncSession, keys: List[Tuple[str, str, str]]) -> se/", "language": "Python", "typeref": "typename:set[Tuple[str,str,str]]", "kind": "function", "signature": "(session: AsyncSession, keys: List[Tuple[str, str, str]])"}, {"_type": "tag", "name": "_resource_key_tuple", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^def _resource_key_tuple(r: ResourceIngestRow) -> Tuple[str, str, str]:$/", "language": "Python", "typeref": "typename:Tuple[str,str,str]", "kind": "function", "signature": "(r: ResourceIngestRow)"}, {"_type": "tag", "name": "bulk_upsert_costs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def bulk_upsert_costs(session: AsyncSession, rows: List[CostIngestRow]) -> tuple[int, int]/", "language": "Python", "typeref": "typename:tuple[int,int]", "kind": "function", "signature": "(session: AsyncSession, rows: List[CostIngestRow])"}, {"_type": "tag", "name": "bulk_upsert_resources", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def bulk_upsert_resources(session: AsyncSession, rows: List[ResourceIngestRow]) -> tuple[i/", "language": "Python", "typeref": "typename:tuple[int,int]", "kind": "function", "signature": "(session: AsyncSession, rows: List[ResourceIngestRow])"}, {"_type": "tag", "name": "generic_insert", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^    from sqlalchemy import insert as generic_insert$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_dialect_insert", "scopeKind": "function", "nameref": "unknown:insert"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^logger = logging.getLogger(\"cloudunify.services.ingest\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "pg_insert", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^        from sqlalchemy.dialects.postgresql import insert as pg_insert$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_dialect_insert", "scopeKind": "function", "nameref": "unknown:insert"}, {"_type": "tag", "name": "sqlite_insert", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^        from sqlalchemy.dialects.sqlite import insert as sqlite_insert$/", "file": true, "language": "Python", "kind": "unknown", "scope": "_dialect_insert", "scopeKind": "function", "nameref": "unknown:insert"}], "hash": "546fdadc20f17f2baeca4cfb4640a1f0", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/src/api/services/ingest.py", "fields": [{"name": "logger = logging.getLogger(\"cloudunify.services.ingest\")", "scope": "", "scopeKind": "", "description": "unavailable"}]}