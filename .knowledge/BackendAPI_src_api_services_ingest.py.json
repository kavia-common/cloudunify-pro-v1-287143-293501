{"is_source_file": true, "format": "Python", "description": "This Python script provides functions for bulk upsert operations on 'Resource' and 'Cost' database models, involving querying existing records in batches, preparing values, and inserting or updating entries using SQLAlchemy's async interface. It is part of a data ingestion service responsible for efficiently processing resource and cost data.", "external_files": ["src.api.models", "src.api.schemas"], "external_methods": ["sqlalchemy.insert", "sqlalchemy.select", "sqlalchemy.func", "sqlalchemy.ext.asyncio.AsyncSession", "src.api.models.Resource", "src.api.models.Cost", "src.api.schemas.ResourceIngestRow", "src.api.schemas.CostIngestRow"], "published": ["bulk_upsert_resources", "bulk_upsert_costs"], "classes": [], "methods": [{"name": "Iterable[Sequence] _chunked(seq: Sequence, size: int)", "description": "Generator that yields successive chunks of the input sequence of specified size.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,str,str] _resource_key_tuple(r: ResourceIngestRow)", "description": "Creates a tuple identifying a resource uniquely based on organization_id, provider, and resource_id.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,str,str,str,str,date] _cost_key_tuple(c: CostIngestRow)", "description": "Creates a tuple identifying a cost record uniquely based on multiple fields including organization_id, cloud_account_id, provider, service_name, region, and cost_date.", "scope": "", "scopeKind": ""}, {"name": "set[Tuple[str,str,str]] _existing_resource_keys(session: AsyncSession, keys: List[Tuple[str, str, str]])", "description": "Queries the database for existing resource keys in batches, returning a set of existing resource identifiers.", "scope": "", "scopeKind": ""}, {"name": "set[Tuple[str,str,str,str,str,date]] _existing_cost_keys( session: AsyncSession, keys: List[Tuple[str, str, str, str, str, date]] )", "description": "Queries the database for existing cost keys in batches, returning a set of existing cost identifiers.", "scope": "", "scopeKind": ""}, {"name": "tuple[int,int] bulk_upsert_resources(session: AsyncSession, rows: List[ResourceIngestRow])", "description": "Performs bulk insert or update operations on Resource records, returning counts of inserted and updated rows.", "scope": "", "scopeKind": ""}, {"name": "tuple[int,int] bulk_upsert_costs(session: AsyncSession, rows: List[CostIngestRow])", "description": "Performs bulk insert or update operations on Cost records, returning counts of inserted and updated rows.", "scope": "", "scopeKind": ""}], "calls": ["logger.info", "select", "tuple_", "insert", "func.now()", "session.execute"], "search-terms": ["ingest", "bulk_upsert", "Resource", "Cost", "asyncio", "SQLAlchemy", "batch processing", "upsert", "resource_key", "cost_key"], "state": 2, "file_id": 9, "knowledge_revision": 23, "git_revision": "", "ctags": [{"_type": "tag", "name": "_chunked", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^def _chunked(seq: Sequence, size: int) -> Iterable[Sequence]:$/", "language": "Python", "typeref": "typename:Iterable[Sequence]", "kind": "function", "signature": "(seq: Sequence, size: int)"}, {"_type": "tag", "name": "_cost_key_tuple", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^def _cost_key_tuple(c: CostIngestRow) -> Tuple[str, str, str, str, str, date]:$/", "language": "Python", "typeref": "typename:Tuple[str,str,str,str,str,date]", "kind": "function", "signature": "(c: CostIngestRow)"}, {"_type": "tag", "name": "_existing_cost_keys", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def _existing_cost_keys($/", "language": "Python", "typeref": "typename:set[Tuple[str,str,str,str,str,date]]", "kind": "function", "signature": "( session: AsyncSession, keys: List[Tuple[str, str, str, str, str, date]] )"}, {"_type": "tag", "name": "_existing_resource_keys", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def _existing_resource_keys(session: AsyncSession, keys: List[Tuple[str, str, str]]) -> se/", "language": "Python", "typeref": "typename:set[Tuple[str,str,str]]", "kind": "function", "signature": "(session: AsyncSession, keys: List[Tuple[str, str, str]])"}, {"_type": "tag", "name": "_resource_key_tuple", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^def _resource_key_tuple(r: ResourceIngestRow) -> Tuple[str, str, str]:$/", "language": "Python", "typeref": "typename:Tuple[str,str,str]", "kind": "function", "signature": "(r: ResourceIngestRow)"}, {"_type": "tag", "name": "bulk_upsert_costs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def bulk_upsert_costs(session: AsyncSession, rows: List[CostIngestRow]) -> tuple[int, int]/", "language": "Python", "typeref": "typename:tuple[int,int]", "kind": "function", "signature": "(session: AsyncSession, rows: List[CostIngestRow])"}, {"_type": "tag", "name": "bulk_upsert_resources", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^async def bulk_upsert_resources(session: AsyncSession, rows: List[ResourceIngestRow]) -> tuple[i/", "language": "Python", "typeref": "typename:tuple[int,int]", "kind": "function", "signature": "(session: AsyncSession, rows: List[ResourceIngestRow])"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293501/BackendAPI/src/api/services/ingest.py", "pattern": "/^logger = logging.getLogger(\"cloudunify.services.ingest\")$/", "language": "Python", "kind": "variable"}], "hash": "4b1d3e89c0011d4314013d62f3bf20dd", "format-version": 4, "code-base-name": "BackendAPI", "filename": "BackendAPI/src/api/services/ingest.py", "fields": [{"name": "logger = logging.getLogger(\"cloudunify.services.ingest\")", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"23": ""}]}